# Implementation Plan: Task Web App (Phase 2)

**Branch**: `1-task-web-app` | **Date**: 2026-01-02 | **Spec**: [specs/1-task-web-app/spec.md](spec.md)

## Summary
Build a full-stack Task Management application using a Next.js (frontend) and FastAPI (backend) monorepo. The app will feature secure JWT authentication (Better Auth), persistence via Neon PostgreSQL (SQLModel), and automated type synchronization using a custom Claude skill.

## Technical Context

**Language/Version**: TypeScript (Frontend), Python 3.12 (Backend)
**Primary Dependencies**: Next.js 16+, FastAPI, Better Auth, SQLModel, Alembic, Pydantic
**Storage**: Neon Serverless PostgreSQL
**Testing**: Vitest (Frontend), Pytest (Backend)
**Target Platform**: Vercel (Frontend), Railway/Docker (Backend)
**Project Type**: Web Application (Monorepo)
**Performance Goals**: <500ms API response time, 100% type safety across boundaries.
**Constraints**: JWT-only auth for protected routes, strict Pydantic validation.

## Constitution Check

| Principle | Adherence |
|-----------|-----------|
| I. Next.js Frontend | Next.js 16+ App Router will be used. |
| II. FastAPI Backend | FastAPI with Pydantic models for REST API. |
| III. Neon DB | SQLModel used with Neon serverless connection strings. |
| IV. Type Safety | Shared types via OpenAPI (api-generator skill). |
| V. TDD | Red-Green-Refactor tasks planned. |

## Project Structure

```text
specs/1-task-web-app/
├── plan.md              # This file
├── research.md          # Monorepo/Auth/DB research findings
├── data-model.md        # DB schema and entity definitions
├── quickstart.md        # Dev setup instructions
├── contracts/           # API schemas
└── tasks.md             # Implementation tasks
```

### Source Code

```text
backend/
├── alembic/             # Database migrations
├── core/                # Config, security, database setup
├── models/              # shared SQLModel definitions
├── routes/              # FastAPI endpoints
├── main.py              # App entry point
└── .env.local           # Backend secrets

frontend/
├── app/                 # Next.js App Router
├── components/          # UI elements (Tailwind)
├── lib/
│   ├── auth-client.ts   # Better Auth config
│   └── generated/       # Sync'd types from backend
└── .env.local           # Frontend secrets
```

## Architecture Details

### 1. Monorepo & Shared Types
- **Strategy**: Backend is the source of truth. OpenAPI schema is generated by FastAPI.
- **Sync**: Use `.claude/skills/api-generator` to fetch schema and generate TypeScript interfaces in `frontend/lib/generated/`.
- **Logic**: Every time `backend/models/*.py` changes, the `api-generator` skill must be re-run.

### 2. Auth Flow
- **Frontend**: Better Auth handles social/email registration and manages active sessions.
- **Backend**: FastAPI middleware extracts the JWT from the `Authorization: Bearer` header and verifies it against the `JWT_SECRET`.
- **Linked**: Both share a common secret or public key for token verification.

### 3. Database & Migrations
- **Neon DB**: Connection string with `sslmode=require`.
- **SQLModel**: Models serve as both DB tables (SQLAlchemy) and API schemas (Pydantic).
- **Alembic**: Handles migrations. `alembic init alembic` will be used to track schema changes.

### 4. Skill Link: api-generator
The custom skill at `.claude/skills/api-generator` will be implemented to automate the following:
1. Fetch `http://localhost:8000/openapi.json`.
2. Map Pydantic fields to TypeScript interfaces.
3. Generate a `TaskAPI` client class for the frontend.

## History
Record of this planning phase is saved in `history/prompts/03-planning.md`.
